<script>
  const apiUrl = 'https://script.google.com/macros/s/AKfycbyzy47hX-roRqeVZoxqCugWRZ543zRJnZXZiFn_1kgO8lFwiIXnrK5oT5ZU1TdHaFKY/exec';

  async function fetchLeaderboard() {
    try {
      const response = await fetch(apiUrl);
      const data = await response.json();
      console.log("Fetched Data:", data);

      if (!Array.isArray(data) || data.length <= 1) {
        throw new Error('Data is empty or invalid format');
      }

      const driversData = data.slice(1).filter(row => row[0] && row[1]);
      console.log("Filtered Drivers Data:", driversData);

      const drivers = driversData.map(row => ({ driver: row[0], team: row[1], totalPoints: row[18] || 0 }))
        .sort((a, b) => b.totalPoints - a.totalPoints);

      const constructorsMap = {};
      driversData.forEach(row => {
        const team = row[1];
        const totalPoints = row[18] || 0;
        if (!constructorsMap[team]) constructorsMap[team] = 0;
        constructorsMap[team] += totalPoints;
      });

      const constructors = Object.keys(constructorsMap).map(team => ({ team, points: constructorsMap[team] }))
        .sort((a, b) => b.points - a.points);

      console.log("Drivers:", drivers);
      console.log("Constructors:", constructors);

      const driversTable = document.getElementById('drivers');
      driversTable.innerHTML = '';
      drivers.forEach(d => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${d.driver}</td><td>${d.team}</td><td>${d.totalPoints}</td>`;
        driversTable.appendChild(row);
      });

      const constructorsTable = document.getElementById('constructors');
      constructorsTable.innerHTML = '';
      constructors.forEach(t => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${t.team}</td><td>${t.points}</td>`;
        constructorsTable.appendChild(row);
      });

    } catch (error) {
      console.error('Error:', error);
      document.getElementById('drivers').innerHTML = '<tr><td colspan="3">Error loading driver data</td></tr>';
      document.getElementById('constructors').innerHTML = '<tr><td colspan="2">Error loading constructor data</td></tr>';
    }
  }

  fetchLeaderboard();
</script>
