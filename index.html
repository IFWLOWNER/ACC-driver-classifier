<body class="bg-gray-100 min-h-screen flex flex-col justify-center items-center text-center">
  <div class="mb-6">
    <a href="https://www.ifwl.net" target="_blank">
      <img src="./ifwl_logo.png" alt="IFWL Logo" class="w-32 h-32 object-contain mx-auto">
    </a>
  </div>
  <div class="bg-white p-8 rounded-2xl shadow-md w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-4">ACC Driver Classification</h1>
    <form id="classificationForm" class="space-y-4">
      <input type="text" id="driverName" placeholder="Driver Name" class="w-full p-2 border rounded" required />

      <select id="track" class="w-full p-2 border rounded" required>
        <option value="">Select Track</option>
        <option>Monza</option>
        <option>Spa Francorchamps</option>
        <option>Silverstone</option>
        <option>Nurburgring GP</option>
        <option>Barcelona</option>
        <option>Zandvoort</option>
        <option>Suzuka</option>
        <option>Paul Ricard</option>
        <option>Imola</option>
        <option>Mount Panorama</option>
        <option>Misano</option>
        <option>Kyalami</option>
        <option>Brands Hatch</option>
        <option>Donnington Park</option>
        <option>Valencia</option>
        <option>Laguna Seca</option>
        <option>Watkins Glen</option>
        <option>Zolder</option>
        <option>Red Bull Ring</option>
        <option>Hungaroring</option>
        <option>Nurburgring Nordchleiffe</option>
      </select>

      <select id="carClass" class="w-full p-2 border rounded" required>
        <option value="">Select Car Class</option>
        <option value="GT3">GT3</option>
        <option value="GT4">GT4</option>
      </select>

      <label for="weather" class="block text-left text-sm font-medium text-gray-700">Weather</label>
      <select id="weather" class="w-full p-2 border rounded" required onchange="document.getElementById('weatherNote').style.display = this.value === 'wet' ? 'block' : 'none';">
        <option value="dry">Dry</option>
        <option value="wet">Wet</option>
      </select>

      <input type="text" id="lapTime" placeholder="Lap Time (e.g. 1:47.382)" class="w-full p-2 border rounded" required pattern="^[0-9]:[0-5][0-9]\.[0-9]{3}$" title="Please enter time in the format m:ss.sss (e.g. 1:47.382)" />

      <p id="weatherNote" class="text-sm text-blue-600 mt-1 hidden">Note: Wet weather adds a 5% buffer to your lap time for fairer classification.</p>

      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Classify Me</button>
    </form>

    <p class="text-sm text-gray-600 mt-6">These times are tailored to IFWL.NET racing league â€“ this league runs a LFM BOP. Times may vary for other leagues. Use this as a base.</p>

    <div id="result" class="mt-4 text-lg font-semibold"></div>

    <div id="simgridPromo" class="mt-6 hidden bg-gray-800 p-4 rounded-lg">
      <a href="https://www.thesimgrid.com/communities/ifwl" target="_blank">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSU9g8cfuSLVQToXqGY4VHMhIsTNT7WTEJ7Bw&s" alt="Join IFWL on SimGrid" class="mx-auto h-16">
      </a>
    </div>
  </div>

  <button onclick="downloadCSV()" class="mt-4 bg-green-600 text-white p-2 rounded hover:bg-green-700">
    Download Submissions CSV
  </button>
<script>
const classificationData = {
  "Monza": { "GT3": ["1:53.71", "1:51.71", "1:49.71", "1:47.71", "1:45.70"] },
  "Spa Francorchamps": { "GT3": ["2:24.89", "2:21.50", "2:18.50", "2:16.00", "2:13.00"] },
  "Silverstone": { "GT3": ["2:04.47", "2:02.47", "2:00.47", "1:58.47", "1:56.47"] },
  "Nurburgring GP": { "GT3": ["2:00.10", "1:58.10", "1:56.10", "1:54.10", "1:52.10"] },
  "Barcelona": { "GT3": ["1:49.60", "1:47.60", "1:45.60", "1:43.60", "1:41.60"] },
  "Zandvoort": { "GT3": ["1:41.50", "1:39.50", "1:37.50", "1:35.50", "1:33.50"] },
  "Suzuka": { "GT3": ["2:06.27", "2:04.27", "2:02.27", "2:00.27", "1:58.27"] },
  "Paul Ricard": { "GT3": ["1:59.90", "1:57.90", "1:55.90", "1:53.90", "1:51.90"] },
  "Imola": { "GT3": ["1:46.97", "1:44.97", "1:42.97", "1:40.97", "1:38.97"] },
  "Mount Panorama": { "GT3": ["2:07.85", "2:05.85", "2:03.85", "2:01.85", "1:59.85"] },
  "Misano": { "GT3": ["1:39.59", "1:37.59", "1:35.59", "1:33.59", "1:31.59"] },
  "Kyalami": { "GT3": ["1:47.72", "1:45.72", "1:43.72", "1:41.72", "1:39.72"] },
  "Brands Hatch": { "GT3": ["1:29.30", "1:27.30", "1:25.30", "1:23.30", "1:21.30"] },
  "Donnington Park": { "GT3": ["1:32.99", "1:30.99", "1:28.99", "1:26.99", "1:24.99"] },
  "Valencia": { "GT3": ["1:36.47", "1:34.47", "1:32.47", "1:30.47", "1:28.47"] },
  "Laguna Seca": { "GT3": ["1:28.42", "1:26.42", "1:24.42", "1:22.42", "1:20.42"] },
  "Watkins Glen": { "GT3": ["1:50.51", "1:48.51", "1:46.51", "1:44.51", "1:42.51"] },
  "Zolder": { "GT3": ["1:33.31", "1:31.31", "1:29.31", "1:27.31", "1:25.31"] },
  "Red Bull Ring": { "GT3": ["1:33.00", "1:31.00", "1:29.00", "1:27.00", "1:25.00"] },
  "Hungaroring": { "GT3": ["1:48.10", "1:46.10", "1:44.10", "1:42.10", "1:40.10"] },
  "Nurburgring Nordchleiffe": { "GT3": ["8:24.34", "8:22.34", "8:20.34", "8:18.34", "8:16.34"] }
};
const classes = [
  "unrealistic - please check your time entry",
  "require improvement - this time is too slow to classify",
  "beginner - IFWL.NET Beginner series is ideal for you",
  "AM - IFWL.NET Pro - am series is ideal for you",
  "high end - AM - IFWL.NET Pro - am series is ideal for you",
  "Pro - IFWL.NET Pro am may suit your race pace",
  "Alien - consider getting a real race car ! :) "
];

function classify(track, carClass, lapTime) {
  const weather = document.getElementById("weather").value;
  const rainImpact = weather === "wet" ? 1.05 : 1;
  if (!classificationData[track] || !classificationData[track][carClass]) return "No data for selected track/class";

  const rawThresholds = classificationData[track][carClass].map(timeToSeconds);
  const alien = rawThresholds[rawThresholds.length - 1];
  const unrealistic = alien * 0.95;
  const pro = alien * 1.02 + 0.01;
  const highAm = pro + 0.01;
  const am = highAm + 0.01;
  const beginner = am + 0.01;
  const requireImprovement = beginner + 0.01;

  const thresholds = [unrealistic, requireImprovement, beginner, am, highAm, pro, alien];
  const userTime = timeToSeconds(lapTime) / rainImpact;

  for (let i = 0; i < thresholds.length; i++) {
    if (userTime <= thresholds[i]) return classes[i];
  }
  return "unrealistic - please check your time entry";
}
</body>
