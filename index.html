<body class="bg-gray-100 min-h-screen flex flex-col justify-center items-center text-center">
  <div class="mb-6">
    <a href="https://www.ifwl.net" target="_blank">
      <img src="./ifwl_logo.png" alt="IFWL Logo" class="w-32 h-32 object-contain mx-auto">
    </a>
  </div>
  <div class="bg-white p-8 rounded-2xl shadow-md w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-4">ACC Driver Classification</h1>
    <form id="classificationForm" class="space-y-4">
      <input type="text" id="driverName" placeholder="Driver Name" class="w-full p-2 border rounded" required />

      <select id="track" class="w-full p-2 border rounded" required>
        <option value="">Select Track</option>
        <option>Monza</option>
        <option>Spa Francorchamps</option>
        <option>Silverstone</option>
        <option>Nurburgring GP</option>
        <option>Barcelona</option>
        <option>Zandvoort</option>
        <option>Suzuka</option>
        <option>Paul Ricard</option>
        <option>Imola</option>
        <option>Mount Panorama</option>
        <option>Misano</option>
        <option>Kyalami</option>
        <option>Brands Hatch</option>
        <option>Donnington Park</option>
        <option>Valencia</option>
        <option>Laguna Seca</option>
        <option>Watkins Glen</option>
        <option>Zolder</option>
        <option>Red Bull Ring</option>
        <option>Hungaroring</option>
        <option>Nurburgring Nordchleiffe</option>
      </select>

      <select id="carClass" class="w-full p-2 border rounded" required>
        <option value="">Select Car Class</option>
        <option value="GT3">GT3</option>
        <option value="GT4">GT4</option>
      </select>

      <label for="weather" class="block text-left text-sm font-medium text-gray-700">Weather</label>
      <select id="weather" class="w-full p-2 border rounded" required onchange="document.getElementById('weatherNote').style.display = this.value === 'wet' ? 'block' : 'none';">
        <option value="dry">Dry</option>
        <option value="wet">Wet</option>
      </select>

      <input type="text" id="lapTime" placeholder="Lap Time (e.g. 1:47.382)" class="w-full p-2 border rounded" required pattern="^[0-9]:[0-5][0-9]\.[0-9]{3}$" title="Please enter time in the format m:ss.sss (e.g. 1:47.382)" />

      <p id="weatherNote" class="text-sm text-blue-600 mt-1 hidden">Note: Wet weather adds a 5% buffer to your lap time for fairer classification.</p>

      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Classify Me</button>
    </form>

    <p class="text-sm text-gray-600 mt-6">These times are tailored to IFWL.NET racing league – this league runs a LFM BOP. Times may vary for other leagues. Use this as a base.</p>

    <div id="result" class="mt-4 text-lg font-semibold"></div>

    <div id="simgridPromo" class="mt-6 hidden bg-gray-800 p-4 rounded-lg">
      <a href="https://www.thesimgrid.com/communities/ifwl" target="_blank">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSU9g8cfuSLVQToXqGY4VHMhIsTNT7WTEJ7Bw&s" alt="Join IFWL on SimGrid" class="mx-auto h-16">
      </a>
    </div>
  </div>

  <button onclick="downloadCSV()" class="mt-4 bg-green-600 text-white p-2 rounded hover:bg-green-700">
    Download Submissions CSV
  </button>

<script>
// Your classification data, class list, and logic
const classificationData = {
  // ... all your track/class lap time data as before ...
};
const classes = [
  "unrealistic - please check your time entry",
  "require improvement - this time is too slow to classify",
  "beginner - IFWL.NET Beginner series is ideal for you",
  "AM - IFWL.NET Pro - am series is ideal for you",
  "high end - AM - IFWL.NET Pro - am series is ideal for you",
  "Pro - IFWL.NET Pro am may suit your race pace",
  "Alien - consider getting a real race car ! :) "
];

function timeToSeconds(timeStr) {
  const parts = timeStr.split(":");
  if (parts.length !== 2) return NaN;
  const [minutes, rest] = parts;
  const [seconds, milliseconds] = rest.split(".");
  return parseInt(minutes) * 60 + parseInt(seconds) + parseInt(milliseconds) / 1000;
}

function classify(track, carClass, lapTime) {
  const weather = document.getElementById("weather").value;
  const rainImpact = weather === "wet" ? 1.05 : 1;
  if (!classificationData[track] || !classificationData[track][carClass]) return "No data for selected track/class";

  const rawThresholds = classificationData[track][carClass].map(timeToSeconds);
  const alien = rawThresholds[rawThresholds.length - 1];
  const unrealistic = alien * 0.95;
  const pro = alien * 1.02 + 0.01;
  const highAm = pro + 0.01;
  const am = highAm + 0.01;
  const beginner = am + 0.01;
  const requireImprovement = beginner + 0.01;

  const thresholds = [unrealistic, requireImprovement, beginner, am, highAm, pro, alien];
  const userTime = timeToSeconds(lapTime) / rainImpact;

  for (let i = 0; i < thresholds.length; i++) {
    if (userTime <= thresholds[i]) return classes[i];
  }
  return "unrealistic - please check your time entry";
}

// ✅ Hook up form submission
document.getElementById("classificationForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const driverName = document.getElementById("driverName").value.trim();
  const track = document.getElementById("track").value;
  const carClass = document.getElementById("carClass").value;
  const lapTime = document.getElementById("lapTime").value.trim();

  const result = classify(track, carClass, lapTime);
  document.getElementById("result").innerText = `${driverName}, your classification is: ${result}`;

  const simgridPromo = document.getElementById("simgridPromo");
  if (["AM", "high end - AM", "Pro", "Alien"].some(level => result.includes(level))) {
    simgridPromo.classList.remove("hidden");
  } else {
    simgridPromo.classList.add("hidden");
  }
});
</script>
</body>
